<!doctype html>
<html>
    <head>
        <title>PnL Dashboard</title>
        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <style>
            body {
                background-color: #f8f9fa;
            }
            .stats-card {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border-radius: 10px;
                padding: 20px;
                text-align: center;
            }
            .positive {
                color: #28a745;
            }
            .negative {
                color: #dc3545;
            }
            .chart-container {
                background: white;
                border-radius: 10px;
                padding: 20px;
                margin-bottom: 20px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }
        </style>
    </head>
    <body>
        <nav class="navbar navbar-dark bg-dark">
            <div class="container">
                <span class="navbar-brand">ðŸ“Š PnL Dashboard</span>
                <a href="/" class="btn btn-outline-light btn-sm"
                    >New Analysis</a
                >
            </div>
        </nav>

        <div class="container mt-4">
            <div class="row mb-4">
                <div class="col-12">
                    <h2>Portfolio Performance</h2>
                    <small class="text-muted">
                        {{ user_address[:8] }}...{{ user_address[-6:] }} | {{
                        days_back }} days
                    </small>
                </div>
            </div>

            <div class="row mb-4">
                <div class="col-md-2">
                    <div class="stats-card">
                        <h6>Total PnL</h6>
                        <h4
                            class="{% if stats.total_pnl >= 0 %}positive{% else %}negative{% endif %}"
                        >
                            ${{ "{:,.2f}".format(stats.total_pnl) }}
                        </h4>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="stats-card">
                        <h6>Avg Daily PnL</h6>
                        <h4
                            class="{% if stats.avg_daily_pnl >= 0 %}positive{% else %}negative{% endif %}"
                        >
                            ${{ "{:,.2f}".format(stats.avg_daily_pnl) }}
                        </h4>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="stats-card">
                        <h6>Win Rate</h6>
                        <h4>{{ "{:.1f}%".format(stats.win_rate) }}</h4>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="stats-card">
                        <h6>Max Drawdown</h6>
                        <h4 class="negative">
                            ${{ "{:,.2f}".format(stats.max_drawdown) }}
                        </h4>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="stats-card">
                        <h6>Total Trades</h6>
                        <h4>{{ stats.total_trades }}</h4>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="stats-card">
                        <h6>Profitable</h6>
                        <h4 class="positive">{{ stats.profitable_trades }}</h4>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-12">
                    <div class="chart-container">
                        <div id="pnlChart"></div>
                    </div>
                </div>
            </div>

            <!-- BTC Comparison Chart -->
            <div class="row">
                <div class="col-12">
                    <div class="chart-container">
                        <div id="btcCompareChart"></div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // Render PnL Chart
            Plotly.newPlot('pnlChart', {{ chart | safe }});

            // Render BTC Comparison Chart
            {% if btc_chart %}
            Plotly.newPlot('btcCompareChart', {{ btc_chart | safe }});
            {% endif %}
        </script>
    </body>
</html>
